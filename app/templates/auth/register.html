{% extends "layouts/base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card shadow-sm border-0 rounded-3">
            <div class="card-body p-4">
                <h5 class="card-title mb-4 text-center">Register</h5>

                <form id="registerForm" method="post" action="/register" novalidate>
                    <!-- Username -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Username</label>
                        <input id="username" class="form-control" name="username"
                               placeholder="username (3–10 chars, letters, digits, . _ -)"
                               pattern="^[A-Za-z0-9_.-]{3,10}$"
                               required autofocus>
                        <div id="usernameError" class="text-danger small mt-1" style="display:none;">
                            Username must be 3–10 characters (letters, digits, '.', '_', or '-').
                        </div>
                    </div>

                    <!-- Password -->
                    <div class="mb-3 position-relative">
                        <label class="form-label fw-semibold">Password</label>
                        <input id="password" type="password" class="form-control pe-5" name="password"
                               placeholder="password (6+ chars, A-Z, a-z, 0-9)"
                               pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$"
                               required>
                        <i id="togglePassword" class="bi bi-eye position-absolute"
                           style="right: 12px; top: 38px; cursor: pointer; color: #6c757d;"></i>
                        <div id="passwordError" class="text-danger small mt-1" style="display:none;">
                            Password must have at least 6 characters, including A-Z, a-z, and 0-9.
                        </div>
                    </div>

                    <!-- Role -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Role</label>
                        <select class="form-select" name="role">
                            <option value="individual">Individual</option>
                            <option value="corporate">Corporate</option>
                        </select>
                    </div>

                    <!-- Submit -->
                    <button class="btn btn-primary w-100 mt-3" type="submit">Create account</button>
                </form>
            </div>
        </div>
    </div>
</div>

<footer class="text-muted small text-center mt-5 site-footer">© 2025 Vincent Hu</footer>

<!-- Password visibility toggle -->
<script>
	document.addEventListener("DOMContentLoaded", function () {
		const toggle = document.getElementById("togglePassword");
		const input = document.getElementById("password");

		toggle.addEventListener("click", () => {
			const show = input.type === "password";
			input.type = show ? "text" : "password";
			toggle.className = show
				? "bi bi-eye-slash position-absolute"
				: "bi bi-eye position-absolute";
			toggle.style.right = "12px";
			toggle.style.top = "38px";
			toggle.style.cursor = "pointer";
			toggle.style.color = show ? "#000" : "#6c757d";
		});
	});
</script>

<!-- Client-side validation for username & password -->
<script>
	document.getElementById("registerForm").addEventListener("submit", function (e) {
		const username = document.getElementById("username").value.trim();
		const password = document.getElementById("password").value;
		const usernameError = document.getElementById("usernameError");
		const passwordError = document.getElementById("passwordError");

		const USERNAME_PATTERN = /^[A-Za-z0-9_.-]{3,10}$/;
		const PASSWORD_PATTERN = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;

		// Reset previous errors
		usernameError.style.display = "none";
		passwordError.style.display = "none";

		let valid = true;

		if (!USERNAME_PATTERN.test(username)) {
			usernameError.style.display = "block";
			valid = false;
		}

		if (!PASSWORD_PATTERN.test(password)) {
			passwordError.style.display = "block";
			valid = false;
		}

		if (!valid) e.preventDefault();
	});

	// Live validation as user types
	document.getElementById("password").addEventListener("input", function () {
		const passwordError = document.getElementById("passwordError");
		const pattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
		passwordError.style.display = pattern.test(this.value) ? "none" : "block";
	});

	document.getElementById("username").addEventListener("input", function () {
		const usernameError = document.getElementById("usernameError");
		const pattern = /^[A-Za-z0-9_.-]{3,10}$/;
		usernameError.style.display = pattern.test(this.value.trim()) ? "none" : "block";
	});
</script>

<!-- Bootstrap Icons -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
{% endblock %}
